[workspace]
authors = ["Michael Booth <michael@databooth.com.au>"]
channels = ["conda-forge", "https://conda.modular.com/max-nightly"]
name = "mojo-inference-service"
platforms = ["osx-arm64", "linux-64"]
version = "0.2.0"

[activation]
env = { MOJO_PATH = "$PIXI_PROJECT_ROOT/src:$HOME/code/github/databooth/mojo-toml/src:$HOME/code/github/databooth/mojo-dotenv/src" }

[dependencies]
modular = "*"
transformers = ">=4.57.3,<5"
pytorch = ">=2.9.1,<3"
optimum = ">=2.1.0,<3"
onnxruntime = ">=1.22.2,<2"
onnxscript = ">=0.5.6,<0.6"
numpy = ">=2.4.0,<3"

[tasks]
# Python examples (MAX Graph)
example-minimal = "python examples/python/minimal_max_graph.py"
example-distilbert = "python src/python/max_distilbert/inference.py"

# Benchmarking
benchmark = "python benchmarks/distilbert_max_vs_hf.py"

# Mojo lexicon classifier
mojo-build = "mojo build -I $HOME/code/github/databooth/mojo-toml/src -I $HOME/code/github/databooth/mojo-dotenv/src src/mojo/lexicon_classifier/main.mojo -o lexicon-classifier"
mojo-run = "mojo run -I $HOME/code/github/databooth/mojo-toml/src -I $HOME/code/github/databooth/mojo-dotenv/src src/mojo/lexicon_classifier/main.mojo"

# Testing
test-mojo = "mojo test tests/mojo/"
test-python = "pytest tests/python/"

# Development tools
mojo-version = "mojo --version"
mojo-format = "mojo format src/mojo/ tests/mojo/"
mojo-check = "mojo check src/mojo/ tests/mojo/"
